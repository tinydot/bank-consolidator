<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Statement Consolidator</title>
    <!--
        TO RUN FULLY OFFLINE (iPhone Safari / file:// ):
        Keep index.html, styles.css, and app.js in the same folder ‚Äî file://
        resolves relative paths, so all three load together automatically.

        To bundle back into a single self-contained file:
        1. Download the 3 CDN libraries below and inline each as <script>‚Ä¶</script>.
        2. Copy styles.css contents into a <style>‚Ä¶</style> in the <head>.
        3. Copy app.js contents into a <script>‚Ä¶</script> before </body>.
        4. Open the single file directly in Safari ‚Äî no server needed.
    -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-asm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üí∞ Bank Statement Consolidator</h1>
            <p class="subtitle">Consolidate multiple bank CSVs into a local SQLite database with analytics</p>
        </header>

        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('import')">üì• Import</button>
                <button class="tab-button" onclick="switchTab('transactions')">üí≥ Transactions</button>
                <button class="tab-button" onclick="switchTab('analytics')">üìä Analytics</button>
                <button class="tab-button" onclick="switchTab('history')">üïë History</button>
                <button class="tab-button" onclick="switchTab('rules')">‚öôÔ∏è Rules</button>
                <button class="tab-button" onclick="switchTab('manual')">‚úèÔ∏è Manual</button>
                <button class="tab-button" onclick="switchTab('budget')">üí∞ Budget</button>
                <button class="tab-button" onclick="switchTab('planner')">üìã Planner</button>
                <button class="tab-button" onclick="switchTab('settings')">üîß Settings</button>
            </div>

            <!-- IMPORT TAB -->
            <div id="import-tab" class="tab-content active">
                <div id="import-message"></div>
                
                <label for="fileInput" style="display: block; cursor: pointer;">
                    <div class="drop-zone" id="dropZone">
                        <div class="drop-zone-icon">üìÅ</div>
                        <h3>Drop CSV files here or click to browse</h3>
                        <p style="color: #7f8c8d; margin-top: 10px;">Supports multiple bank formats</p>
                    </div>
                </label>
                <input type="file" id="fileInput" accept=".csv" multiple style="display: none;">

                <div id="bankProfileSelector" style="display: none;">
                    <div class="form-group">
                        <label>Select Bank Profile</label>
                        <select id="bankProfileSelect" onchange="updateAccountOptions(); updateImportPreview(true)"></select>
                    </div>
                    <div class="form-group">
                        <label>Date Format</label>
                        <select id="importDateFormat" onchange="updateImportPreview()">
                            <option value="auto">Auto-detect</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD (e.g. 2025-01-31)</option>
                            <option value="DD/MM/YYYY">DD/MM/YYYY (e.g. 31/01/2025)</option>
                            <option value="MM/DD/YYYY">MM/DD/YYYY (e.g. 01/31/2025)</option>
                            <option value="DD-MM-YYYY">DD-MM-YYYY (e.g. 31-01-2025)</option>
                            <option value="MM-DD-YYYY">MM-DD-YYYY (e.g. 01-31-2025)</option>
                            <option value="DD/MM/YY">DD/MM/YY (e.g. 31/01/25)</option>
                            <option value="MM/DD/YY">MM/DD/YY (e.g. 01/31/25)</option>
                            <option value="DD-Mon-YY">DD-Mon-YY (e.g. 16-Feb-26)</option>
                            <option value="DD-Mon-YYYY">DD-Mon-YYYY (e.g. 16-Feb-2026)</option>
                        </select>
                        <p style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">Overrides the profile setting for this import only</p>
                    </div>
                    <div id="importPreview" style="margin-bottom: 20px;"></div>
                    <div class="form-group">
                        <label>Select Account</label>
                        <select id="accountSelect">
                            <option value="">Select account...</option>
                        </select>
                        <button onclick="showAddAccount()" style="margin-top: 10px;" class="secondary-btn">+ Add New Account</button>
                    </div>
                    <div id="addAccountForm" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <div class="form-group">
                            <label>Account Name</label>
                            <input type="text" id="newAccountName" placeholder="e.g., Checking, Savings, Credit Card">
                        </div>
                        <div class="form-group">
                            <label>Account Number (last 4 digits, optional)</label>
                            <input type="text" id="newAccountNumber" placeholder="e.g., 1234">
                        </div>
                        <button onclick="addAccount()">Create Account</button>
                        <button class="secondary-btn" onclick="cancelAddAccount()">Cancel</button>
                    </div>
                    <button onclick="processUploadedFiles()" style="margin-top: 15px;">Import Transactions</button>
                    <button class="secondary-btn" onclick="cancelUpload()">Cancel</button>
                </div>

                <div id="mappingPreview"></div>
            </div>

            <!-- TRANSACTIONS TAB -->
            <div id="transactions-tab" class="tab-content">
                <div class="filters">
                    <div class="form-group">
                        <label>Bank</label>
                        <select id="filterBank" onchange="loadTransactions()">
                            <option value="">All Banks</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Account</label>
                        <select id="filterAccount" onchange="loadTransactions()">
                            <option value="">All Accounts</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="filterCategory" onchange="updateSubcategoryFilter(); loadTransactions();">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Subcategory</label>
                        <select id="filterSubcategory" onchange="loadTransactions()">
                            <option value="">All Subcategories</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>From Date</label>
                        <input type="date" id="filterDateFrom" onchange="loadTransactions()">
                    </div>
                    <div class="form-group">
                        <label>To Date</label>
                        <input type="date" id="filterDateTo" onchange="loadTransactions()">
                    </div>
                    <div class="form-group">
                        <label>Search</label>
                        <input type="text" id="filterSearch" placeholder="Description..." oninput="debouncedLoadTransactions()">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="filterShowIgnored" onchange="loadTransactions()">
                            <option value="active">Active only</option>
                            <option value="ignored">Ignored only</option>
                            <option value="all">All transactions</option>
                        </select>
                    </div>
                </div>

                <div class="button-group">
                    <button onclick="exportToCSV()">üì• Export to CSV</button>
                    <button onclick="downloadDatabase()" class="secondary-btn">üíæ Download Database</button>
                    <button onclick="exportReport()" style="background:#27ae60; color:white; border-color:#27ae60;">üìä Export Report</button>
                </div>

                <div id="transactionsContainer"></div>
            </div>

            <!-- ANALYTICS TAB -->
            <div id="analytics-tab" class="tab-content">
                <div class="chart-container">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h3 style="margin:0;">Transaction Details by Category</h3>
                        <div id="tagViewMonthNav" style="display:flex; align-items:center; gap:8px;">
                            <button onclick="changeTagMonth(-1)" style="padding:4px 10px; font-size:12px;">‚Üê Prev</button>
                            <span id="tagViewMonthLabel" style="font-size:13px; font-weight:600; min-width:120px; text-align:center;"></span>
                            <button onclick="changeTagMonth(1)" id="tagViewNextBtn" style="padding:4px 10px; font-size:12px;">Next ‚Üí</button>
                        </div>
                    </div>
                    <div id="categoryDetailTags"></div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 20px;">Monthly Breakdown (Last 6 Months)</h3>
                    <div id="monthlyBreakdownTable"></div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 20px;">Spending by Category (Last 6 Months)</h3>
                    <canvas id="categoryChart"></canvas>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 20px;">Last Transaction Date by Account</h3>
                    <div id="lastTransactionTable"></div>
                </div>
            </div>

            <!-- IMPORT HISTORY TAB -->
            <div id="history-tab" class="tab-content">
                <h3 style="margin-bottom: 20px;">Import History</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">View and manage your CSV imports</p>
                <div id="importHistoryContainer"></div>
            </div>

            <!-- RULES TAB -->
            <div id="rules-tab" class="tab-content">
                <h3 style="margin-bottom: 20px;">Transaction Rules</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Automatically ignore or categorize transactions based on keywords</p>
                
                <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3498db;">
                    <strong>üí° How it works:</strong> Rules automatically process transactions during import:
                    <ul style="margin: 10px 0 0 20px;">
                        <li><strong>Auto-Ignore:</strong> Mark matching transactions as ignored</li>
                        <li><strong>Auto-Categorize:</strong> Assign category to matching transactions (coming soon)</li>
                    </ul>
                </div>

                <div class="button-group" style="margin-bottom: 20px;">
                    <button onclick="showAddRuleForm()">+ Add New Rule</button>
                    <button onclick="applyRulesToExisting()" class="secondary-btn">‚ö° Apply Rules to Existing</button>
                </div>

                <div id="addRuleForm" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">Add New Rule</h4>
                    <div class="form-group">
                        <label>Rule Name</label>
                        <input type="text" id="newRuleName" placeholder="e.g., Ignore ATM Fees">
                    </div>
                    <div class="form-group">
                        <label>Keyword (description must contain)</label>
                        <input type="text" id="newRuleKeyword" placeholder="e.g., ATM FEE, TRANSFER, STARBUCKS">
                    </div>
                    <div class="form-group">
                        <label>Action</label>
                        <select id="newRuleAction" onchange="toggleCategoryField()">
                            <option value="ignore">Auto-Ignore</option>
                            <option value="categorize" selected>Auto-Categorize</option>
                        </select>
                    </div>
                    <div class="form-group" id="categoryFieldGroup">
                        <label>Category</label>
                        <select id="newRuleCategory" onchange="updateRuleSubcategoryOptions()">
                            <!-- Populated from database -->
                        </select>
                    </div>
                    <div class="form-group" id="subcategoryFieldGroup" style="display: none;">
                        <label>Subcategory (optional)</label>
                        <select id="newRuleSubcategory">
                            <option value="">-- None --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="newRuleCaseSensitive">
                            Case sensitive
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Priority (higher = applied first)</label>
                        <input type="number" id="newRulePriority" value="10" min="0" max="100">
                        <p style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">
                            Use priority when rules might conflict. Higher priority rules are checked first.
                        </p>
                    </div>
                    <button onclick="addRule()">Create Rule</button>
                    <button class="secondary-btn" onclick="cancelAddRule()">Cancel</button>
                </div>

                <div id="rulesListContainer"></div>
            </div>

            <!-- MANUAL TAB -->
            <div id="manual-tab" class="tab-content">
                <div id="manual-message"></div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">

                    <!-- Entry Form -->
                    <div>
                        <h3 style="margin-bottom: 20px;">Add Transaction</h3>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="manualDate">
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <select id="manualSign" style="width: auto;">
                                    <option value="-">‚àí Expense</option>
                                    <option value="+">+ Income</option>
                                </select>
                                <input type="number" id="manualAmount" placeholder="0.00" min="0" step="0.01" style="flex: 1;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <input type="text" id="manualDescription" placeholder="e.g. Coffee with client">
                        </div>
                        <button onclick="addManualTransaction()">Add Transaction</button>
                    </div>

                    <!-- Summary -->
                    <div>
                        <h3 style="margin-bottom: 20px;">Summary</h3>
                        <div id="manualSummary" style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #7f8c8d;">Total Entries</span>
                                <strong id="manualCount">0</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #7f8c8d;">Total Income</span>
                                <strong id="manualIncome" class="transaction-positive">$0.00</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #7f8c8d;">Total Expenses</span>
                                <strong id="manualExpenses" class="transaction-negative">$0.00</strong>
                            </div>
                            <hr style="border: none; border-top: 1px solid #ecf0f1; margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #7f8c8d;">Net</span>
                                <strong id="manualNet">$0.00</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transactions List -->
                <div style="margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3>Entries</h3>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button onclick="applyRulesToManualTransactions()" class="secondary-btn" style="padding: 6px 12px; font-size: 13px;">‚öôÔ∏è Apply Rules</button>
                            <input type="month" id="manualFilterMonth" onchange="loadManualTransactions()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>
                    <div id="manualTransactionsContainer"></div>
                </div>
            </div>

            <!-- BUDGET TAB -->
            <div id="budget-tab" class="tab-content">
                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
                    <h3 style="margin:0;">Monthly Budget</h3>
                    <div style="display:flex; align-items:center; gap:12px;">
                        <button id="budgetPrevBtn" class="secondary-btn" style="padding:6px 14px;" onclick="shiftBudgetMonth(-1)">‚Üê Prev</button>
                        <span id="budgetMonthLabel" style="font-size:16px; font-weight:600; min-width:110px; text-align:center;"></span>
                        <button id="budgetNextBtn" class="secondary-btn" style="padding:6px 14px;" onclick="shiftBudgetMonth(1)">Next ‚Üí</button>
                    </div>
                </div>
                <p style="color: #7f8c8d; margin-bottom: 24px;" id="budgetSubtitle">Set a monthly spending limit per category. Leave blank for no limit.</p>
                <div id="budgetContainer"></div>
            </div>

            <!-- PLANNER TAB -->
            <div id="planner-tab" class="tab-content">
                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
                    <h3 style="margin:0;">Emergency Fund Planner</h3>
                    <button onclick="showAddCommitmentForm()" style="padding:6px 16px;">+ Add Expense</button>
                </div>
                <p style="color:#7f8c8d; margin-bottom:20px;">
                    Plan your fixed commitments and variable spend for the next 6 months. The total is your minimum emergency fund target.
                </p>

                <!-- Add/Edit form -->
                <div id="plannerForm" style="display:none; background:#f8f9fa; border-radius:8px; padding:20px; margin-bottom:20px;">
                    <h4 id="plannerFormTitle" style="margin:0 0 16px;">Add Expense Commitment</h4>
                    <input type="hidden" id="plannerEditId">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                        <div class="form-group" style="margin:0;">
                            <label>Description</label>
                            <input type="text" id="plannerDesc" placeholder="e.g. Childcare, Tuition">
                        </div>
                        <div class="form-group" style="margin:0;">
                            <label>Amount (SGD)</label>
                            <input type="number" id="plannerAmount" min="0" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group" style="margin:0;">
                            <label>Category</label>
                            <select id="plannerCategory" onchange="updatePlannerSubcategoryOptions()">
                                <option value="">‚Äî None ‚Äî</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin:0;">
                            <label>Subcategory <span style="color:#95a5a6; font-weight:400;">(optional)</span></label>
                            <select id="plannerSubcategory">
                                <option value="">‚Äî None ‚Äî</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin:0;">
                            <label>Type</label>
                            <select id="plannerType" onchange="togglePlannerTypeFields()">
                                <option value="monthly">Monthly (every month)</option>
                                <option value="term">Term / specific dates</option>
                            </select>
                        </div>
                        <div class="form-group" id="plannerMonthsField" style="margin:0;">
                            <label>Active months <span style="color:#95a5a6; font-weight:400;">(leave blank = all 12)</span></label>
                            <input type="text" id="plannerActiveMonths" placeholder="e.g. 1,2,3 or leave blank">
                        </div>
                        <div class="form-group" id="plannerDatesField" style="display:none; grid-column:1/-1; margin:0;">
                            <label>Payment dates <span style="color:#95a5a6; font-weight:400;">(YYYY-MM-DD, comma-separated)</span></label>
                            <input type="text" id="plannerDates" placeholder="e.g. 2026-03-01, 2026-06-01, 2026-09-01">
                        </div>
                        <div class="form-group" style="grid-column:1/-1; margin:0;">
                            <label>Notes <span style="color:#95a5a6; font-weight:400;">(optional)</span></label>
                            <input type="text" id="plannerNotes" placeholder="e.g. Due on 1st of month">
                        </div>
                    </div>
                    <div style="margin-top:16px; display:flex; gap:8px;">
                        <button onclick="saveCommitment()">Save</button>
                        <button class="secondary-btn" onclick="cancelPlannerForm()">Cancel</button>
                    </div>
                </div>

                <!-- Variable spend row -->
                <div style="background:#fff8e1; border:1px solid #f39c12; border-radius:8px; padding:14px 18px; margin-bottom:20px; display:flex; align-items:center; gap:16px;">
                    <span style="font-size:18px;">üí∞</span>
                    <div style="flex:1;">
                        <div style="font-weight:600; margin-bottom:2px;">Monthly variable spend estimate</div>
                        <div style="font-size:12px; color:#7f8c8d;">Food, transport, utilities and other non-fixed costs</div>
                    </div>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span style="color:#7f8c8d; font-size:13px;">S$</span>
                        <input type="number" id="plannerVariableSpend" min="0" step="1" placeholder="0"
                            style="width:100px; text-align:right; font-size:16px; font-weight:600; border:1px solid #ddd; border-radius:4px; padding:4px 8px;">
                        <span style="color:#7f8c8d; font-size:13px;">/ mo</span>
                        <button class="secondary-btn" style="padding:4px 12px; font-size:12px;" onclick="savePlannerVariable()">Save</button>
                    </div>
                </div>

                <!-- Financial Health Check -->
                <div id="financialHealthCheck" style="background:#f8f9fa; border:1px solid #dee2e6; border-radius:8px; padding:20px; margin-bottom:24px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                        <h4 style="margin:0;">üí∞ Financial Health Check</h4>
                        <button onclick="showUpdateBalanceForm()" class="secondary-btn" style="padding:6px 12px; font-size:13px;">Update Balance</button>
                    </div>
                    <div id="balanceDisplay">
                        <div style="color:#7f8c8d; font-size:13px;">No bank balance recorded yet. Click "Update Balance" to add.</div>
                    </div>
                </div>

                <!-- Update Balance Form -->
                <div id="updateBalanceForm" style="display:none; background:#fff; border:1px solid #dee2e6; border-radius:8px; padding:20px; margin-bottom:24px;">
                    <h4 style="margin:0 0 16px;">Update Bank Balance</h4>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                        <div class="form-group" style="margin:0;">
                            <label>Account Name</label>
                            <select id="balanceAccountName"></select>
                        </div>
                        <div class="form-group" style="margin:0;">
                            <label>Current Balance (SGD)</label>
                            <input type="number" id="balanceAmount" min="0" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group" style="margin:0;">
                            <label>As of Date</label>
                            <input type="date" id="balanceDate">
                        </div>
                    </div>
                    <div style="margin-top:16px; display:flex; gap:8px;">
                        <button onclick="saveBalance()">Save Balance</button>
                        <button class="secondary-btn" onclick="cancelBalanceForm()">Cancel</button>
                    </div>
                </div>

                <!-- Planned Activities -->
                <div style="margin-bottom:24px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                        <h4 style="margin:0;">üéØ Planned Activities</h4>
                        <div style="display:flex; gap:8px;">
                            <button onclick="showActivityTemplates()" class="secondary-btn" style="padding:6px 12px; font-size:13px;">üìã From Template</button>
                            <button onclick="showAddActivityForm()" style="padding:6px 12px; font-size:13px;">+ Add Activity</button>
                        </div>
                    </div>

                    <!-- Activity Form -->
                    <div id="activityForm" style="display:none; background:#fff; border:1px solid #dee2e6; border-radius:8px; padding:20px; margin-bottom:16px;">
                        <h4 id="activityFormTitle" style="margin:0 0 16px;">Add Activity</h4>
                        <input type="hidden" id="activityEditId">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:16px;">
                            <div class="form-group" style="margin:0;">
                                <label>Activity Name</label>
                                <input type="text" id="activityName" placeholder="e.g. Zoo Trip, Japan Vacation">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label>Type</label>
                                <select id="activityType">
                                    <option value="domestic">Domestic (uses category budgets)</option>
                                    <option value="overseas">Overseas (standalone)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" style="margin:0 0 12px;">
                            <label>Notes <span style="color:#95a5a6; font-weight:400;">(optional)</span></label>
                            <input type="text" id="activityNotes" placeholder="e.g. Weekend trip, Summer vacation">
                        </div>
                        <div style="background:#f8f9fa; border-radius:6px; padding:12px; margin-bottom:12px;">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                <strong style="font-size:13px;">Cost Items</strong>
                                <button onclick="addActivityItem()" class="secondary-btn" style="padding:4px 10px; font-size:12px;">+ Add Item</button>
                            </div>
                            <div id="activityItemsList"></div>
                        </div>
                        <div style="display:flex; gap:8px;">
                            <button onclick="saveActivity()">Save Activity</button>
                            <button class="secondary-btn" onclick="cancelActivityForm()">Cancel</button>
                        </div>
                    </div>

                    <!-- Template Picker -->
                    <div id="templatePicker" style="display:none; background:#fff; border:1px solid #dee2e6; border-radius:8px; padding:20px; margin-bottom:16px;">
                        <h4 style="margin:0 0 16px;">Choose Template</h4>
                        <div id="templatesList"></div>
                        <button class="secondary-btn" onclick="cancelTemplatePicker()" style="margin-top:12px;">Cancel</button>
                    </div>

                    <!-- Unscheduled Activities -->
                    <div id="unscheduledActivities" style="border:1px solid #dee2e6; border-radius:8px; padding:16px; margin-bottom:16px;">
                        <h5 style="margin:0 0 12px; color:#7f8c8d; font-size:13px; text-transform:uppercase;">Unscheduled (Keep in View)</h5>
                        <div id="unscheduledList"></div>
                    </div>

                    <!-- Scheduled Activities by Month -->
                    <div id="scheduledActivities"></div>
                </div>

                <!-- 6-month table -->
                <div id="plannerTable"></div>
            </div>

            <!-- SETTINGS TAB -->
            <div id="settings-tab" class="tab-content">
                <h3 style="margin-bottom: 20px;">Analytics Settings</h3>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <h4 style="margin-bottom: 10px;">Manual Transactions in Analytics</h4>
                    <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;">
                        Include manual transactions in analytics alongside imported bank statements. 
                        Set a start date to avoid duplicates (typically the date after your last bank import).
                    </p>
                    <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                        <div class="form-group" style="margin: 0;">
                            <label>
                                <input type="checkbox" id="includeManualInAnalytics" onchange="toggleManualAnalytics()">
                                Include manual transactions in analytics
                            </label>
                        </div>
                        <div class="form-group" style="margin: 0;">
                            <label>Start Date</label>
                            <input type="date" id="manualAnalyticsStartDate" disabled>
                        </div>
                        <button onclick="saveManualAnalyticsSettings()" style="padding: 8px 16px;">Save Settings</button>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <h4 style="margin-bottom: 10px;">Monthly Expected Income</h4>
                    <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;">
                        Set your fixed monthly income (e.g. salary). The analytics header will use this instead of
                        deriving income from transactions, so the "Remaining" figure is meaningful even before
                        your salary arrives.
                    </p>
                    <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                        <div class="form-group" style="margin: 0;">
                            <label>Monthly Income</label>
                            <input type="number" id="monthlyExpectedIncome" placeholder="e.g. 5000" min="0" step="0.01" style="width:160px;">
                        </div>
                        <button onclick="saveMonthlyIncome()" style="padding: 8px 16px;">Save</button>
                        <button class="secondary-btn" onclick="clearMonthlyIncome()" style="padding: 8px 16px;">Clear</button>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px;">Categories</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Manage transaction categories</p>

                <div class="button-group" style="margin-bottom: 20px;">
                    <button onclick="showAddCategoryForm()">+ Add Category</button>
                </div>

                <div id="addCategoryForm" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">Add New Category</h4>
                    <div class="form-group">
                        <label>Category Name</label>
                        <input type="text" id="newCategoryName" placeholder="e.g., Fitness, Subscriptions">
                    </div>
                    <div class="form-group">
                        <label>Icon (emoji)</label>
                        <input type="text" id="newCategoryIcon" placeholder="e.g., üí™, üì±" maxlength="2">
                    </div>
                    <div class="form-group">
                        <label>Color</label>
                        <input type="color" id="newCategoryColor" value="#3498db">
                    </div>
                    <button onclick="addCategory()">Create Category</button>
                    <button class="secondary-btn" onclick="cancelAddCategory()">Cancel</button>
                </div>

                <div id="categoriesListContainer"></div>

                <hr style="margin: 40px 0; border: none; border-top: 1px solid #ecf0f1;">

                <h3 style="margin-bottom: 20px;">Bank Profiles</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Configure CSV column mappings for different banks</p>

                <div id="bankProfilesList"></div>

                <button onclick="addBankProfile()">+ Add New Bank Profile</button>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="danger-btn" onclick="clearDatabase()">üóëÔ∏è Clear All Data</button>
                    <button class="secondary-btn" onclick="importDatabase()">üìÇ Import Database</button>
                </div>
                <input type="file" id="dbImportInput" accept=".db,.sqlite,.sqlite3" style="display: none;">
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
